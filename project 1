import csv
#with open("penguins.csv") as csv_file: 
    #csv_reader= csv.reader(csv_file)

    #for row in csv_reader:
        #print(row)

def filter_by_island(csv_file, island_name):
    data= []
    with open(csv_file, newline='') as file:
        reader= csv.DictReader(file)
        for row in reader:
            if row ["island"] == island_name:
                data.append(row)
    
        return data
    
def filter_by_species(csv_file, species_name):
    data= []
    with open(csv_file, newline='') as file:
        reader= csv.DictReader(file)
        for row in reader:
            if row ["species"] == species_name:
                data.append(row)
    return data

def filter_by_sex(csv_file):
    data= []
    with open(csv_file, newline='') as file:
        reader= csv.DictReader(file)
        for row in reader:
            if row ["sex"] == "Female":
                data.append(row)
    return data
    
def calculate_flipper_percentage(csv_file, island_name= "Dream", species_name= "Chinstrap", threshold=190):
    total= 0
    above_threshold= 0 
    with open(csv_file, newline='') as file:
        reader= csv.DictReader(file)
        for row in reader: 
            if row ["island"]== island_name and row ["species"]== species_name:
                flipper_length = row["flipper_length_mm"]
                
                if not flipper_length or flipper_length == "NA":
                    continue
                    
                flipper=  float(flipper_length)
                total += 1
                if flipper > threshold:
                    above_threshold += 1
              

    percentage = 0
    if total > 0:
        percentage = round((above_threshold / total) * 100, 2)
    return percentage
    
def most_common_female_species(csv_file, island_name= "Biscoe"):
    count_species= {}
    island_name_lower= island_name.strip().lower()
    with open(csv_file, newline='') as file:
        reader= csv.DictReader(file)
        for row in reader:
            island = row.get("island", "").strip().lower()
            sex = row.get("sex", "").strip().lower()

            if sex != "female":
                continue
            
            if island == island_name_lower:
                species = row.get("species", "").strip()
                if species in count_species:
                    count_species[species] += 1
                else:
                    count_species[species]=1
    if not count_species:
        return None
     

    most_common_species = max(count_species, key=count_species.get)
    return most_common_species

#TESTS

def test_calculate_flipper_percentage():
    result = calculate_flipper_percentage("penguins.csv", "Dream", "Chinstrap", 190)
    assert result == 77.94, f"Expected 77.94 but got {result}"

def test_different_species():
    result= calculate_flipper_percentage("penguins.csv", "Biscoe", "Adelie", 180)
    assert result == 88.64, f"Expected 88.64 but got {result}"

def test_no_match():
    result= calculate_flipper_percentage("penguins.csv", "Torgersen", "Adelie", 210)
    assert result == 0, f"Expected 0 but got {result}"

def test_all_above_threshold():
    result= calculate_flipper_percentage("penguins.csv", "Biscoe", "Gentoo", 190)
    assert result == 100.0, f"Expected 100.0 but got {result}"
    



def test_filter_female_penguins():
    result = most_common_female_species("penguins.csv", "Biscoe")
    assert result == "Gentoo", f"Expected 'Gentoo', got {result}"

def test_other_island():
    result= most_common_female_species("penguins.csv", "Dream")
    assert result == "Chinstrap", f"Expected 'Chinstrap', got {result}"

def test_no_penguin_matches():
    result= most_common_female_species("penguins.csv")
    assert result is not None, f"Expected a species, but got None"

def test_fake_island():
    result= most_common_female_species("penguins.csv", "Atlantis")
    assert result is None, f"Expected None but got {result}"


#RESULTS
def results_csv(filename="penguin_results.csv"):
    results = [
        ["Description", "Value"],
        ["Most common female species on Biscoe", most_common_female_species("penguins.csv", "Biscoe")],
        ["Dream Chinstrap flipper > 190 (%)", f"{calculate_flipper_percentage('penguins.csv', 'Dream', 'Chinstrap', 190)}%"],
    ]

    with open(filename, "w", newline="") as f:
        writer = csv.writer(f)
        writer.writerows(results)

    print(f"Results written to {filename}")

if __name__ == "__main__":
    test_calculate_flipper_percentage()
    test_different_species()
    test_no_match()
    test_all_above_threshold()
    test_filter_female_penguins()
    test_other_island()
    test_no_penguin_matches()
    test_fake_island()
    results_csv()
    print("Pass")